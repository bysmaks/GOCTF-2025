# PNG analyzer | hard | pwn

## Информация

> Мы разработали совершенно новый анализатор PNG, который поможет узнать все о заголовках внутри PNG файла. Делимся с тобой тем что смогли достать. Посмотришь?

IP:PORT

## Деплой

Флаг от задания положить в flag.txt

```sh
cd deploy
docker-compose up --build -d
```

## Выдать участинкам

бинарник [public/converter](public/converter) и IP:PORT сервера

## Описание

Переполнение буффера, т.к. его обьем формируется по спаршенным из IHDR чанка размерам, а писать мы можем больше чем указали. Переписать адрес возврата.

## Решение

Замечаем, что размер буффера получается из png_data.height * png_data.width. Которые в свою очередь парсятся из IHDR чанка PNG файла. Задаем его произвольным значением(соблюдая структуру PNG), полностью заполняем хламом(IDAT чанки, так как только из них данные кладутся в буффер). Понимаем что мы можем писать и дальше. Ищем сдвиг, который начнет что то ломать. Находим. Нам мешает chunk_type переменная которая содержит b'IDAT'. Если мы это переписываем то программа просто перестанет прибалвять к buffer_offset data_length. Сделаем небольшую хитрость и запишем туда b'IEND', чтобы при проверке типа чанка мы сразу завершили цикл и перешли на адрес возврата. Далее нам нужно записать chunk_length, так как он испольуется далее по программе и должен быть корректным. Дальше до адреса возврата остается еще немного. Пишем туда нули и парочку адресов, которые определяем через gdb в т.ч. адрес открытого файла чтобы его позже закрыть. Переписываем адрес возврата на адрес функции get_something. Получаем флаг.

[Эксплоит](solve/generate.py)

## Флаг

`goctf{your_custom_flag}`

